pipeline {
    agent {
        docker { 
            image 'docker:latest'  // Usa a imagem Docker dentro do agente
            args '-v /var/run/docker.sock:/var/run/docker.sock'  // Permite o uso do Docker do host
        }
    }

    stages {
        stage('Pull Apache Image') {
            steps {
                sh 'docker pull httpd:latest'  // Baixa a imagem mais recente do Apache
            }
        }

        stage('Run Apache Container') {
            steps {
                sh '''
                    docker run -d --name apache-server -p 8080:80 httpd:latest
                '''  // Sobe o container do Apache mapeando a porta 8080 para a porta 80 do container
            }
        }

        stage('Check Container') {
            steps {
                sh 'docker ps'  // Verifica se o container está rodando
            }
        }
    }

    post {
        always {
            script {
                // Limpa o container após a execução para evitar deixar resíduos
                sh 'docker rm -f apache-server || true'
            }
        }
    }
}
